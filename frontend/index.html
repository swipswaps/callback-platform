<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Request a callback - Connect instantly with our team"/>
  <title>Request a Callback</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Google reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Request a Callback</h1>
      <p class="subtitle">Connect with us instantly - we'll call you back</p>
      <button id="settings-btn" class="settings-btn" title="View System Logs">âš™ï¸</button>
    </header>

    <!-- Backend Status Indicator -->
    <div id="backend-status">
      <div class="backend-status status-checking">
        <span class="status-icon">ğŸ”„</span>
        <span class="status-text">Checking backend connection...</span>
      </div>
    </div>

    <!-- Setup Wizard Link (shown when Twilio not configured) -->
    <div id="setup-wizard-notice" style="display: none; background: #fff3cd; border-left: 4px solid #ffc107; padding: 16px; margin: 20px 0; border-radius: 4px;">
      <h3 style="margin-top: 0; color: #856404;">âš™ï¸ Twilio Not Configured</h3>
      <p style="color: #856404;">To enable real phone callbacks, you need to configure Twilio credentials.</p>
      <a href="setup.html" style="display: inline-block; margin-top: 10px; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;">
        ğŸš€ Run Setup Wizard
      </a>
    </div>

    <!-- Authentication Required Section -->
    <div id="auth-required" class="auth-section">
      <div class="auth-notice">
        <span class="lock-icon">ğŸ”’</span>
        <h3>Sign In to Request Callback</h3>
        <p>To ensure quality service and prevent abuse, please sign in with one of the following:</p>
      </div>

      <div class="social-login">
        <div class="social-buttons">
          <button class="social-btn google" data-provider="google">
            <span class="icon">G</span> Continue with Google
          </button>
          <button class="social-btn facebook" data-provider="facebook">
            <span class="icon">f</span> Continue with Facebook
          </button>
          <button class="social-btn instagram" data-provider="instagram">
            <span class="icon">ğŸ“·</span> Continue with Instagram
          </button>
          <button class="social-btn x" data-provider="x">
            <span class="icon">ğ•</span> Continue with X
          </button>
        </div>
      </div>

      <div class="security-notice">
        <p>ğŸ” <strong>Why sign in?</strong> This prevents spam and ensures we can reach you.</p>
        <p>ğŸ”’ <strong>Privacy:</strong> We never share your information. Your data is secure.</p>
      </div>
    </div>

    <!-- User Profile (shown when logged in) -->
    <div id="user-profile" class="user-profile" style="display: none;">
      <div class="profile-card">
        <div class="profile-info">
          <span class="profile-icon">ğŸ‘¤</span>
          <div class="profile-details">
            <strong id="profile-name">Loading...</strong>
            <small id="profile-email">Loading...</small>
          </div>
        </div>
        <button id="logout-btn" class="logout-btn">Sign Out</button>
      </div>
    </div>

    <form id="callbackForm" style="display: none;">
      <div class="form-group">
        <label for="name">Full Name</label>
        <input 
          type="text" 
          id="name" 
          name="name"
          placeholder="John Doe" 
          autocomplete="name"
        />
      </div>

      <div class="form-group">
        <label for="email">Email Address</label>
        <input 
          type="email" 
          id="email" 
          name="email"
          placeholder="john@example.com" 
          autocomplete="email"
        />
      </div>

      <div class="form-group">
        <label for="phone">Phone Number <span class="required">*</span></label>
        <input
          type="tel"
          id="phone"
          name="phone"
          placeholder="+1 (555) 123-4567"
          required
          autocomplete="tel"
          pattern="[\+]?[0-9\s\-\(\)]+"
        />
        <small class="help-text">Include country code for international numbers</small>
        <small class="help-text" style="display: block; margin-top: 8px; color: #666;">
          ğŸ“± If we miss you, we'll send a text with options to leave a voicemail or get help
        </small>
      </div>

      <!-- Honeypot field - hidden from users, catches bots -->
      <div class="form-group" style="position: absolute; left: -9999px; opacity: 0; pointer-events: none;" aria-hidden="true">
        <label for="website">Website (leave blank)</label>
        <input
          type="text"
          id="website"
          name="website"
          tabindex="-1"
          autocomplete="off"
        />
      </div>

      <!-- Google reCAPTCHA v2 widget -->
      <div class="captcha-container">
        <div class="g-recaptcha" data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"></div>
        <small class="help-text">This site is protected by reCAPTCHA</small>
      </div>

      <button type="submit" class="submit-btn">
        ğŸ“ Request Callback Now
      </button>
    </form>

    <!-- Verification Code Section (hidden by default) -->
    <div id="verification-section" class="verification-section" style="display: none;">
      <div class="verification-card">
        <h3>ğŸ“± Verify Your Phone Number</h3>
        <p class="verification-message">
          We sent a 6-digit verification code to <strong id="verification-phone"></strong>
        </p>

        <div class="form-group">
          <label for="verification-code">Enter Verification Code</label>
          <input
            type="text"
            id="verification-code"
            name="verification-code"
            placeholder="000000"
            maxlength="6"
            pattern="[0-9]{6}"
            autocomplete="one-time-code"
            inputmode="numeric"
            required
          />
          <small class="help-text">Code expires in <span id="code-timer">10:00</span></small>
        </div>

        <button id="verify-btn" class="submit-btn">
          âœ“ Verify Code
        </button>

        <button id="resend-btn" class="resend-btn" style="margin-top: 12px;">
          ğŸ”„ Resend Code
        </button>

        <button id="cancel-verification-btn" class="cancel-btn" style="margin-top: 8px;">
          â† Back to Form
        </button>
      </div>
    </div>

    <div id="status" class="status-message" role="status" aria-live="polite"></div>

    <footer class="info-section">
      <h4>How It Works</h4>

      <!-- Instructions when NOT authenticated -->
      <ol id="instructions-unauthenticated">
        <li>Sign in with Google or Facebook to auto-fill your details</li>
        <li>Enter your phone number</li>
        <li>Complete the CAPTCHA verification</li>
        <li>Verify your phone number with the SMS code we send</li>
        <li>We'll call you first to verify you're available</li>
        <li>Once you answer, we connect you to our team</li>
        <li>If we miss your call, you'll receive an SMS</li>
      </ol>

      <!-- Instructions when authenticated -->
      <ol id="instructions-authenticated" style="display: none;">
        <li>Enter your phone number in the form above</li>
        <li>Complete the CAPTCHA verification</li>
        <li>Verify your phone number with the SMS code we send</li>
        <li>We'll call you first to verify you're available</li>
        <li>Once you answer, we connect you to our team</li>
        <li>If we miss your call, you'll receive an SMS</li>
      </ol>

      <p class="privacy-note">
        ğŸ”’ Your privacy matters. We never share your information.
        Calls are not recorded by default.
      </p>
    </footer>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“‹ System Logs</h2>
        <button class="modal-close" id="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="log-controls">
          <label>Lines:
            <select id="log-lines">
              <option value="50">50</option>
              <option value="100" selected>100</option>
              <option value="200">200</option>
              <option value="500">500</option>
              <option value="1000">1000</option>
            </select>
          </label>
          <label>Filter:
            <select id="log-filter">
              <option value="">All Logs</option>
              <option value="twilio">Twilio</option>
              <option value="oauth">OAuth</option>
              <option value="error">Errors</option>
              <option value="callback">Callbacks</option>
              <option value="sms">SMS</option>
            </select>
          </label>
          <button id="refresh-logs">ğŸ”„ Refresh</button>
          <label>
            <input type="checkbox" id="auto-refresh-logs"> Auto-refresh (10s)
          </label>
        </div>
        <textarea id="log-output" readonly></textarea>
        <div id="log-status"></div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>

